---
title: "Final_Exam_Shaik"
output: html_document
date: "2025-12-11"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

Parameters:

```{r}
dx <- 1 # miles
dt <- 1 # months 

Tmax <- 200
time <- 0:Tmax
nt <- length(time)
loops = 1000
```

Means: 
```{r}
r_mean <- 0.81     # per capita monthly growth
K_mean <- 943      # carrying capacity
D_mean <- 0.22    # diffusion constant (miles/month)
```

Standard Deviations (unceratinties):
```{r}
r_sd <- 0.05 * r_mean
K_sd <- 0.05 * K_mean
D_sd <- 0.05 * D_mean
```

Thresholds:
```{r}
min_threshold = 8.1 #crabs per mile 
max_threshold = 202 #crabs per mile 
```

Variables:
```{r}
Distance_SH = 27 # montauk <> southampton in miles 
Distance_NYC = 118 # montauk <> NYC in miles 
max_dist <- Distance_NYC + 5 #range 
```

Function Definition (Loosely Based off of Lab 08):
```{r}
crab_invasion <- function(r, K, D, dx = 1, Tmax = 200, max_dist = 123, N0 = 100) {
  x <- seq(0, max_dist, by = dx)
  nx <- length(x)
  time <- 0:Tmax
  nt <- length(time)
  
  N_matrix <- matrix(0, nrow = nt, ncol = nx)
  N <- rep(0, nx)
  N[1] <- N0
  N_matrix[1, ] <- N
  
  for (t in 1:(nt - 1)) {
    N_new <- N
    for (j in 2:(nx - 1)) {
      N_new[j] <- N[j] + D *(N[j - 1] - 2*N[j] + N[j + 1]) #old population + immigration diffusion - emigration
    }
    N_new[1] <- N[1] + D * (N[2] - N[1])
    N_new <- N_new + r * N_new * (1-N_new/K) # + growth 
    N_matrix[t + 1, ] <- N_new
    N <- N_new
  }
  return(N_matrix)
}

```

Monte Carlo Initialization: 
```{r}
x <- seq(0, max_dist, by = dx)
nx <- length(x)

Tmax <- 200
time <- 0:Tmax
nt <- length(time)
loops = 1000

crab_mc <- array(0, dim = c(loops, nt, nx))
D_mc  = rnorm(loops, mean = D_mean, sd = D_sd)        # diffusion parameter uncertainty
r_mc  = rnorm(loops, mean = r_mean, sd = r_sd)      # growth uncertainty
K_mc  = rnorm(loops, mean = K_mean, sd = K_sd)        # carrying capacity uncertainty

#non-zero contraints
D_mc[D_mc < 0] <- 0
r_mc[r_mc < 0] <- 0
K_mc[K_mc < 0] <- 0

reachNYC_mc <- rep(NA, loops)                 
reachSH_mc  <- rep(NA, loops) #when min threshold is reached 
maxSH_mc <- rep(NA, loops) #when threshold is exceeded 

for (i in 1:loops) {
  N_matrix <- crab_invasion(r_mc[i], K_mc[i], D_mc[i], dx=dx, Tmax=Tmax, max_dist=max_dist, N0=100)
  crab_mc[i,,] <- N_matrix
  
  popSH <- N_matrix[, Distance_SH + 1]
  reachSH_mc[i] <- which(popSH >= min_threshold)[1]
  maxSH_mc[i] <- which(popSH >= max_threshold)[1]
  
  popNYC <- N_matrix[, Distance_NYC + 1]
  reachNYC_mc[i] <- which(popNYC >= min_threshold)[1]
}
```

```{r}
SH_all <- crab_mc[, , Distance_SH +1] #population at southampton 

#95% CI
CI_SH <- apply(SH_all, 2, quantile, probs = c(.025, .975))

#mean population 
SH_mean <- apply(SH_all, 2, mean)
plot(
  time, SH_mean, type = "l",
  xlab = "Time (months)", ylab = "Population in Southampton",
  col = "turquoise", lwd = 2
)

lines(time, CI_SH[1, ], col = "purple", lwd = 3)
lines(time, CI_SH[2, ], col = "purple", lwd = 3)

abline(h = min_threshold,  col = "blue",  lwd = 2)
abline(h = max_threshold, col = "red",   lwd = 2)

legend(
  "bottomright",
  legend = c("Mean", "95% CI", "Min. Threshold", "Max. Threshold"),
  col    = c("turquoise", "purple", "blue", "red"),
  lty    = c(1, 1, 1, 1),
  lwd    = c(2, 3, 2, 2)
)
```
```{r}

hist(reachSH_mc, main="time until establishment in southampton",
     xlab="months till establishment reached")
abline(v = mean(reachSH_mc, na.rm=TRUE), col="blue", lwd=2)
abline(v = quantile(reachSH_mc, c(.025,.975), na.rm=TRUE), 
       col="red", lwd=2, lty=2)
legend("topright",
  legend = c("mean arrival time", "95% CI"),
  col    = c("blue", "red"),
  lty    = c(1, 2),
  lwd    = c(2, 2)
)

```
```{r}
hist(maxSH_mc, main="time till eradication in southampton",
     xlab="months until max threshold is reached")
abline(v = mean(maxSH_mc, na.rm=TRUE), col="blue", lwd=2)
abline(v = quantile(maxSH_mc, c(.025,.975), na.rm=TRUE), 
       col="red", lwd=2, lty=2)

legend("topright",
  legend = c("mean eradication time", "95% CI"),
  col    = c("blue", "red"),
  lty    = c(1, 2),
  lwd    = c(2, 2))

```

```{r}

NYC_all <- crab_mc[, , Distance_NYC+1] #population at nyc 

#95% CI
CI_NYC <- apply(NYC_all, 2, quantile, probs = c(.025, .975))

#mean population 
NYC_mean <- apply(NYC_all, 2, mean)

plot(
  time, NYC_mean, type = "l", main = "time series plot of nyc population establishment",
  xlab = "Time (months)", ylab = "Population in NYC",
  col = "turquoise", lwd = 2
)

lines(time, CI_NYC[1, ], col = "purple", lwd = 3)
lines(time, CI_NYC[2, ], col = "purple", lwd = 3)

abline(h = min_threshold,  col = "blue",  lwd = 2)
abline(h = max_threshold, col = "red",   lwd = 2)

legend(
  "topleft",
  legend = c("Mean", "95% CI", "Min. Threshold", "Max. Threshold"),
  col    = c("turquoise", "purple", "blue", "red"),
  lty    = c(1, 1, 1, 1),
  lwd    = c(2, 3, 2, 2)
)
```

```{r}
hist(reachNYC_mc, main="time till establishment in nyc",
     xlab="Time (months)")
abline(v = mean(reachNYC_mc, na.rm = TRUE), col="blue", lwd=2)
abline(v = quantile(reachNYC_mc, c(.025,.975), na.rm=TRUE), 
       col="red", lwd=2, lty=2)
legend("topright",
  legend = c("mean establishment time", "95% CI"),
  col    = c("blue", "red"),
  lty    = c(1, 2),
  lwd    = c(2, 2))
```

Quantities: 
```{r}
#95% interval for southampton establishment
quantile(reachSH_mc, probs=c(0.025, 0.975), na.rm=TRUE)

#95% interval for southhampton eradication
quantile(maxSH_mc, probs=c(0.025, 0.975), na.rm=TRUE)

#95% interval for nyc establishment
quantile(reachNYC_mc, probs=c(0.025, 0.975), na.rm=TRUE)
```

```{r}
mean_establish_SH <- mean(reachSH_mc, na.rm = TRUE)
mean_max_SH <- mean(maxSH_mc, na.rm = TRUE)
mean_establish_NYC <- mean(reachNYC_mc, na.rm = TRUE)

mean_establish_SH
mean_max_SH
mean_establish_NYC
```
